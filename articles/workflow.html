<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="deposits">
<title>Example deposits workflow • deposits</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example deposits workflow">
<meta property="og:description" content="deposits">
<meta property="og:image" content="https://docs.ropensci.org/deposits/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">deposits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.1.057</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/deposits.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/deposits-R6.html">The deposits R6 client</a>
    <a class="dropdown-item" href="../articles/frictionless.html">frictionless workflows with deposits</a>
    <a class="dropdown-item" href="../articles/install-setup.html">Installation and Setup</a>
    <a class="dropdown-item" href="../articles/metadata.html">deposits metadata</a>
    <a class="dropdown-item" href="../articles/versioning.html">Publication and versioning</a>
    <a class="dropdown-item" href="../articles/workflow.html">Example deposits workflow</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropenscilabs/deposits/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example deposits workflow</h1>
                        <h4 data-toc-skip class="author">Mark Padgham</h4>
            
            <h4 data-toc-skip class="date">2024-03-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropenscilabs/deposits/blob/HEAD/vignettes/workflow.Rmd" class="external-link"><code>vignettes/workflow.Rmd</code></a></small>
      <div class="d-none name"><code>workflow.Rmd</code></div>
    </div>

    
    
<p>This vignette provides an example of a complete deposits workflow, from initiation of a deposits client through to data publication.</p>
<div class="section level2">
<h2 id="initial-metadata">Initial Metadata<a class="anchor" aria-label="anchor" href="#initial-metadata"></a>
</h2>
<p>As described in <a href="https://docs.ropensci.org/deposits/articles/metadata.html">the metadata vignette</a>, deposits start with metadata describing general aspects of the data being deposited, such as a title, description, identification of creators, and any other aspects specified in <a href="https://github.com/ropenscilabs/deposits/blob/main/inst/extdata/dc/schema.json" class="external-link">the deposits metadata JSON schema</a>.</p>
<p>This workflow will use the same “beaver” datasets as <a href="https://docs.ropensci.org/deposits/articles/metadata.html">the metadata vignette</a>, from <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/beavers.html" class="external-link">R’s “datasets” package</a>. That vignette demonstrated how to use the error messages triggered by incorrectly specified metadata to work towards the following, schema-compliant specification:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span></span>
<span>    creator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"P.S. Reynolds"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    created <span class="op">=</span> <span class="st">"1994-01-01T00:00:00"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Time-series analyses of beaver body temperatures."</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Original source of 'beaver' data, in Chapter 11 of  Lange, N., Ryan, L., Billard, L., Brillinger, D., Conquest, L. and Greenhouse, J. eds (1994) Case Studies in Biometry."</span>,</span>
<span>    publisher <span class="op">=</span> <span class="st">"John Wiley and Sons"</span>,</span>
<span>    isPartOf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span></span>
<span>        identifier <span class="op">=</span> <span class="st">"ark:/13960/t0mt2n370"</span>,</span>
<span>        relation <span class="op">=</span> <span class="st">"isPartOf"</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The “isPartOf” element is a key part of “deposits” metadata, enabling individual data sources to be systematically related to other resources, in this case to the book first describing these data which has an associated “ark” identifier. These fields are intended to help linking data depositions with other project outcomes, such as publications, other data sets, or general project descriptions. Fields for these purposes include “hasPart”, “hasVersion”, “isPartOf”, “isReferencedBy”, “isReplacedBy”, “isRequiredBy”, and “isVersionOf”, with details of all fields given in the <a href="https://github.com/ropenscilabs/deposits/blob/main/inst/extdata/dc/schema.json" class="external-link">deposits JSON schema</a>.</p>
<p>Those metadata can then be used to initiate a deposits client with <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-depositsClient-new">the <code>new()</code> method</a>, demonstrated here with <code>sandbox = TRUE</code> to use the Zenodo “sandbox” environment.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/depositsClient.html">depositsClient</a></span><span class="op">$</span><span class="fu">new</span> <span class="op">(</span></span>
<span>    service <span class="op">=</span> <span class="st">"zenodo"</span>,</span>
<span>    sandbox <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    metadata <span class="op">=</span> <span class="va">metadata</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">cli</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;deposits client&gt;</span></span>
<span><span class="co">#&gt; deposits service : zenodo</span></span>
<span><span class="co">#&gt;           sandbox: TRUE</span></span>
<span><span class="co">#&gt;         url_base : https://sandbox.zenodo.org/api/</span></span>
<span><span class="co">#&gt; Current deposits : &lt;none&gt;</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;   hostdata : &lt;none&gt;</span></span>
<span><span class="co">#&gt;   metadata : 6 terms (see 'metadata' element for details)</span></span></code></pre></div>
<p>The metadata can be edited and extended as desired. The metadata recorded in the deposits client can be updated after each edit with <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-fill-metadata-">the <code>deposit_fill_metadata()</code> method</a>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_fill_metadata</span> <span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span></code></pre></div>
<p>While it is always possible to edit deposits metadata directly by passing values to <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-fill-metadata-">the <code>deposit_fill_metadata()</code> method</a>, the recommended procedure is to generate a “frictionless” metadata file, as described in <a href="https://docs.ropensci.org/deposits/articles/frictionless.html">the vignette of the same name</a>, and to edit the metadata directly in that file. This procedure is demonstrated in the following section. A frictionless metadata file can only be initially generated in response to an actual data resource, and thus the next section begins by generating some example data.</p>
</div>
<div class="section level2">
<h2 id="preparing-data-sources">Preparing data sources<a class="anchor" aria-label="anchor" href="#preparing-data-sources"></a>
</h2>
<p>The <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/beavers.html" class="external-link">“beaver” data</a> actually comprises two datasets, “beaver1” and “beaver2”, each of which is a time series of body temperature measurements from an individual beaver. For data sources to be uploaded by deposits, they must first exist on a local computer, meaning in this case that copies of these beaver datasets must first be written to local files.</p>
<p>The deposits package presumes that a single deposits lives within a dedicated local directory which includes all associated files. Let’s start by making a temporary directory and storing the “beaver” data there:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beaver_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span> <span class="op">(</span><span class="op">)</span>, <span class="st">"beaver"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span> <span class="op">(</span><span class="va">beaver_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span> <span class="op">(</span><span class="va">beaver_dir</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">bv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">beaver_dir</span>, <span class="st">"beaver1.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span> <span class="op">(</span><span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/beavers.html" class="external-link">beaver1</a></span>, <span class="va">bv1</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">bv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">beaver_dir</span>, <span class="st">"beaver2.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span> <span class="op">(</span><span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/beavers.html" class="external-link">beaver1</a></span>, <span class="va">bv2</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We can then connect the deposits client with that local directory with the <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-add-resource-"><code>deposit_add_resource()</code> method</a>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_add_resource</span> <span class="op">(</span><span class="va">beaver_dir</span><span class="op">)</span></span></code></pre></div>
<p>Printing the client, by typing <code>print(cli)</code>, or simply <code>cli</code>, then reveals that it has been connected with the local directory holding those data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">cli</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;deposits client&gt;</span></span>
<span><span class="co">#&gt; deposits service : zenodo</span></span>
<span><span class="co">#&gt;           sandbox: TRUE</span></span>
<span><span class="co">#&gt;         url_base : https://sandbox.zenodo.org/api/</span></span>
<span><span class="co">#&gt; Current deposits : &lt;none&gt;</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;   hostdata : &lt;none&gt;</span></span>
<span><span class="co">#&gt;   metadata : 6 terms (see 'metadata' element for details)</span></span>
<span><span class="co">#&gt; local_path : /tmp/RtmpPru5st/beaver</span></span>
<span><span class="co">#&gt;  resources : 2 local, 0 remote</span></span></code></pre></div>
<div class="section level3">
<h3 id="frictionless-metadata">Frictionless metadata<a class="anchor" aria-label="anchor" href="#frictionless-metadata"></a>
</h3>
<p>Calling the <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-add-resource-"><code>deposit_add_resource()</code> method</a>: the first time also writes a <a href="https://docs.ropensci.org/deposits/articles/frictionless.html#local-generation">“frictionless” metadata file</a> to the <code>local_path</code> directory:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span> <span class="op">(</span><span class="va">beaver_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "beaver1.csv"      "beaver2.csv"      "datapackage.json"</span></span></code></pre></div>
<p>The additional “datapackage.json” file is initially generated by <a href="https://docs.ropensci.org/frictionless" class="external-link">the “frictionless” R package</a>, which automatically fills out details of each “resource”, or local file, in a “resources” section. The deposits package then inserts the metadata specified above into an additional “metadata” section of the file. The following code illustrates a portion of the contents of that file:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span> <span class="op">(</span><span class="va">beaver_dir</span>, pattern <span class="op">=</span> <span class="st">"datapackage"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span> <span class="op">(</span><span class="va">dp</span><span class="op">)</span> <span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "{"</span></span>
<span><span class="co">#&gt;  [2] "  \"profile\": \"tabular-data-package\","</span></span>
<span><span class="co">#&gt;  [3] "  \"metadata\": {"</span></span>
<span><span class="co">#&gt;  [4] "    \"created\": \"1994-01-01T00:00:00\","</span></span>
<span><span class="co">#&gt;  [5] "    \"creator\": ["</span></span>
<span><span class="co">#&gt;  [6] "      {"</span></span>
<span><span class="co">#&gt;  [7] "        \"name\": \"P.S. Reynolds\""</span></span>
<span><span class="co">#&gt;  [8] "      }"</span></span>
<span><span class="co">#&gt;  [9] "    ],"</span></span>
<span><span class="co">#&gt; [10] "    \"description\": \"Original source of 'beaver' data, in Chapter 11 of  Lange, N., Ryan, L., Billard, L., Brillinger, D., Conquest, L. and Greenhouse, J. eds (1994) Case Studies in Biometry.\","</span></span>
<span><span class="co">#&gt; [11] "    \"isPartOf\": ["</span></span>
<span><span class="co">#&gt; [12] "      {"</span></span>
<span><span class="co">#&gt; [13] "        \"identifier\": \"ark:/13960/t0mt2n370\","</span></span>
<span><span class="co">#&gt; [14] "        \"relation\": \"isPartOf\""</span></span>
<span><span class="co">#&gt; [15] "      }"</span></span>
<span><span class="co">#&gt; [16] "    ],"</span></span>
<span><span class="co">#&gt; [17] "    \"publisher\": \"John Wiley and Sons\","</span></span>
<span><span class="co">#&gt; [18] "    \"title\": \"Time-series analyses of beaver body temperatures.\""</span></span>
<span><span class="co">#&gt; [19] "  },"</span></span>
<span><span class="co">#&gt; [20] "  \"resources\": ["</span></span>
<span><span class="co">#&gt; [21] "    {"</span></span>
<span><span class="co">#&gt; [22] "      \"name\": \"beaver1\","</span></span>
<span><span class="co">#&gt; [23] "      \"path\": \"beaver1.csv\","</span></span>
<span><span class="co">#&gt; [24] "      \"profile\": \"tabular-data-resource\","</span></span>
<span><span class="co">#&gt; [25] "      \"format\": \"csv\","</span></span></code></pre></div>
<p>Once a frictionless “datapackage.json” file has been generated, any subsequent editing of metadata should be done by directly editing that file. Editing should also generally involve extending the automatically-inserted “resource” metadata describing the structure of the actual files, as described in the documentation for <a href="https://docs.ropensci.org/frictionless" class="external-link">the frictionless R package</a>.</p>
<p>Edited and updated versions of metadata can then be loaded into a deposits client by passing the path to the directory as the <code>path</code> argument to <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-update-">the <code>deposit_update()</code> method</a>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_update</span> <span class="op">(</span><span class="va">beaver_dir</span><span class="op">)</span></span></code></pre></div>
<p>Instead of <code>beaver_dir</code>, the full path to the local “datapackage.json” file can also be passed. While the same effect can be achieved by calling <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-fill-metadata-">the <code>deposit_fill_metadata()</code> method</a> for deposits which have not been initiated on the remote service, the <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-update-"><code>deposit_update()</code> method</a> has additional effects after that point, and is the recommended method once a “datapackage.json” file has been generated. This is demonstrated in the subsequent section.</p>
<p>The following code demonstrates modification and updating of metadata by first modifying the “title”, and then showing that those changes are reflected in the client itself:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span> <span class="op">(</span><span class="va">dp</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span> <span class="op">(</span><span class="st">"\"title\""</span>, <span class="va">m</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span> <span class="op">(</span><span class="st">"Time"</span>, <span class="st">"Modified time"</span>, <span class="va">m</span> <span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">m</span>, <span class="va">dp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">title</span> <span class="co"># original title</span></span>
<span><span class="co">#&gt; [1] "Time-series analyses of beaver body temperatures."</span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_update</span> <span class="op">(</span><span class="va">beaver_dir</span><span class="op">)</span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">title</span></span>
<span><span class="co">#&gt; [1] "Modified time-series analyses of beaver body temperatures."</span></span></code></pre></div>
<p>In short, metadata editing with deposits is generally done by editing a local “datapackage.json” file, after which a deposits client can then be updated with <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-update-">the <code>deposit_update()</code> method</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="initiating-a-remote-deposit">Initiating a remote deposit<a class="anchor" aria-label="anchor" href="#initiating-a-remote-deposit"></a>
</h2>
<p>The metadata held within a deposits client can be used to initiate a remote deposit on the specified service with <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-new-">the <code>deposit_new()</code> method</a>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_new</span> <span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ID of new deposit : 1065666</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">cli</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;deposits client&gt;</span></span>
<span><span class="co">#&gt;  deposits service : zenodo</span></span>
<span><span class="co">#&gt;            sandbox: TRUE</span></span>
<span><span class="co">#&gt;          url_base : https://sandbox.zenodo.org/api/</span></span>
<span><span class="co">#&gt;  Current deposits : &lt;none&gt;</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;  url_service : https://sandbox.zenodo.org/deposit/1065666</span></span>
<span><span class="co">#&gt;   deposit id : 1065666</span></span>
<span><span class="co">#&gt;     hostdata : list with 14  elements</span></span>
<span><span class="co">#&gt;     metadata : 7 terms (see 'metadata' element for details)</span></span>
<span><span class="co">#&gt;   local_path : /tmp/RtmpMd4uB8/beaver</span></span>
<span><span class="co">#&gt;    resources : 2 local, 0 remote</span></span></code></pre></div>
<p>The client now contains additional “hostdata” elements, containing all data recorded by Zenodo for that deposit. The default print method for the client now also lists additional information including a URL for the new deposit, and a unique identifier. In most R environments, the URL can be directly clicked to view the deposit online. All new deposits are private, and can only be viewed after first logging in to the service.</p>
<p>Metadata can still be edited and updated within a client through modifying the “datapackage.json” file. The metadata held on Zenodo can then be updated by calling <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-update-">the <code>deposit_update()</code> method</a>.</p>
</div>
<div class="section level2">
<h2 id="uploading-files-to-a-remote-deposit">Uploading files to a remote deposit<a class="anchor" aria-label="anchor" href="#uploading-files-to-a-remote-deposit"></a>
</h2>
<p>The main purpose of the deposits package, and of online deposition services, is to deposit data. This is done with <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-upload-file-">the <code>deposit_upload_file()</code> method</a>. The main parameter, <code>path</code>, can also be either a single file or an entire directory. If <code>path</code> specifies a directory, all files contained within that directory are uploaded.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_upload_file</span> <span class="op">(</span><span class="va">beaver_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; frictionless metadata file has been generated as '/tmp/RtmpCPOaqC/beaver/beaver1.csv'</span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="va">hostdata</span><span class="op">$</span><span class="va">files</span> <span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                           checksum         filename filesize</span></span>
<span><span class="co">#&gt; 1 c8e7ff1e2e4323198b4be5227ff63864      beaver1.csv     1909</span></span>
<span><span class="co">#&gt; 2 c8e7ff1e2e4323198b4be5227ff63864      beaver2.csv     1909</span></span>
<span><span class="co">#&gt; 3 4fd4b5167c28a874170ab611daf824e7 datapackage.json     1225</span></span></code></pre>
<p>The “hostdata” of the client now indicate that the three files have been successfully uploaded.</p>
<div class="section level3">
<h3 id="file-compression">File compression<a class="anchor" aria-label="anchor" href="#file-compression"></a>
</h3>
<p>The <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-upload-file-"><code>deposit_upload_file()</code> method</a> includes a <code>compress</code> parameter which defaults to <code>"no"</code> for no compression, but can also be set to <code>"tar"</code> or <code>"zip"</code> to compress files prior to uploading. Compression is generally recommended for large files, both to ease uploading and downloading, and to reduce storage sizes on the host services. The frictionless “datapackage.json” file is always stored in uncompressed format, to enable direct inspection via the online platforms. The following code demonstrates the effects of file compression:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_upload_file</span> <span class="op">(</span><span class="va">beaver_dir</span>, compress <span class="op">=</span> <span class="st">"tar"</span><span class="op">)</span></span>
<span><span class="co">#&gt; frictionless metadata file has been generated as '/tmp/RtmpCPOaqC/beaver/beaver1.csv'</span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="va">hostdata</span><span class="op">$</span><span class="va">files</span> <span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                           checksum         filename filesize</span></span>
<span><span class="co">#&gt; 1 03dd72dacab515750494745e17e4f37c   beaver1.tar.gz     3584</span></span>
<span><span class="co">#&gt; 2 713ce15cb9d3c2b2b6ba8d541c0934a5   beaver2.tar.gz     3584</span></span>
<span><span class="co">#&gt; 3 4fd4b5167c28a874170ab611daf824e7 datapackage.json     1225</span></span></code></pre>
<p>The frictionless “datapackage.json” files are never compressed, ensuring that their contents can always be viewed on the web interfaces of the deposits services. (The increase in sizes of the uploaded files there demonstrates that compression often offers little advantage for small files. The advantages for large files can nevertheless be considerable, and compression is generally recommended.)</p>
<p>To change compression, or to compress a file that was previously uploaded in uncompressed form, the file first needs to be removed from the deposits service with <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-delete-file-">the <code>deposit_delete_file()</code> method</a>, and then re-uploaded with either <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-upload-file-"><code>deposit_upload_file()</code></a> or <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-update-"><code>deposit_update()</code></a>.</p>
</div>
<div class="section level3">
<h3 id="editing-and-updating-files">Editing and updating files<a class="anchor" aria-label="anchor" href="#editing-and-updating-files"></a>
</h3>
<p>The <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-update-"><code>deposit_update()</code> method</a> will automatically update any files held on a remote deposits service if they have been locally modified. If the local “datapackage.json” file has been modified, any changes in the “metadata” section will be brought into the local deposits client, and also translated to service-specific metadata, posted to the service, and returned in updated “hostdata” of the client. The remote version of that file will also be updated.</p>
<p>In short, <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-upload-file-">the <code>deposit_upload_file()</code> method</a> is only needed to initially upload files (or directories). Once files exist on the remote deposits service, the <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-update-"><code>deposit_update()</code> method</a> can be used to automatically upload any modified files to the service.</p>
</div>
</div>
<div class="section level2">
<h2 id="publishing-a-deposit">Publishing a deposit<a class="anchor" aria-label="anchor" href="#publishing-a-deposit"></a>
</h2>
<p>The final steps of publishing a deposit, potentially along with an embargo date, are described in <a href="https://docs.ropensci.org/deposits/articles/deposits.html">the main vignette</a>, but copied here for completeness.</p>
<p>Once all metadata and data have been satisfactorily edited, updated, and uploaded, a deposit can be made publicly visible and permanently associated a Digital Object Identifier (DOI) by publishing it. Prior to publishing, it is often desired to apply an “embargo” to the deposit, in the form of a date after which the deposit will become publicly visible. The two steps to publication are thus generally:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_embargo</span> <span class="op">(</span>embargo_date <span class="op">=</span> <span class="st">"2030-03-30"</span><span class="op">)</span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_publish</span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Calling <a href="https://docs.ropensci.org/deposits/reference/depositsClient.html#method-deposit-publish-">the <code>deposit_publish()</code> method</a> is irreversible, and can never be undone. The published deposit will be permanently associated with the account of the user who published it, as identified by <a href="https://docs.ropensci.org/deposits/articles/install-setup.html#setup-api-tokens">the API token used to initiate the deposits client</a>. Publication will also change many items of the client’s “hostdata”, notably involving a change of status or visibility from “private” to “public”. Once a deposit has been published, the associated DOI, or equivalent the URL given in the deposits client, may be shared as a permanent link to the deposit.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
